{
  "filename": "txc.md",
  "__html": "<h1>TXC事务模式</h1>\n<h2>一、原理介绍：</h2>\n<p>    TXC模式命名来源于阿里云的GTS，实现原理是在执行SQL之前，先查询SQL的影响数据保存起来然后再执行业务。当需要回滚的时候就采用这些记录数据回滚事务。</p>\n<h2>二、模式特点:</h2>\n<ul>\n<li>该模式同样对代码的嵌入性低。</li>\n<li>该模式仅限于对支持SQL方式的模块支持。</li>\n<li>该模式由于每次执行SQL之前需要先查询影响数据，因此相比LCN模式消耗资源与时间要多。</li>\n<li>该模式不会占用数据库的连接资源。</li>\n</ul>\n<h2>三、非MySQL扩展</h2>\n<p>TXC 默认的数据库存储是用的Mysql，若需使用其他类型数据库可通过重新定义TxcSettingFactory Bean的方式来扩展\nTxcSettingFactoryBean接口</p>\n<pre><code class=\"language-java\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-class\"><span class=\"hljs-keyword\">interface</span> <span class=\"hljs-title\">TxcSettingFactory</span> </span>{\n\n    <span class=\"hljs-comment\">/**\n     * 允许TXC事务模式\n     *\n     * <span class=\"hljs-doctag\">@return</span>\n     */</span>\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">default</span> <span class=\"hljs-keyword\">boolean</span> <span class=\"hljs-title\">enable</span><span class=\"hljs-params\">()</span> </span>{\n        <span class=\"hljs-keyword\">return</span> <span class=\"hljs-keyword\">true</span>;\n    }\n\n    <span class=\"hljs-comment\">/**\n     * 锁表名称\n     *\n     * <span class=\"hljs-doctag\">@return</span>\n     */</span>\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">default</span> String <span class=\"hljs-title\">lockTableName</span><span class=\"hljs-params\">()</span> </span>{\n        <span class=\"hljs-keyword\">return</span> SqlUtils.LOCK_TABLE;\n    }\n\n    <span class=\"hljs-comment\">/**\n     * 撤销SQL信息表名\n     *\n     * <span class=\"hljs-doctag\">@return</span>\n     */</span>\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">default</span> String <span class=\"hljs-title\">undoLogTableName</span><span class=\"hljs-params\">()</span> </span>{\n        <span class=\"hljs-keyword\">return</span> SqlUtils.UNDO_LOG_TABLE;\n    }\n\n    <span class=\"hljs-comment\">/**\n     * 事务锁表创建SQL\n     *\n     * <span class=\"hljs-doctag\">@return</span>\n     */</span>\n    <span class=\"hljs-function\">String <span class=\"hljs-title\">lockTableSql</span><span class=\"hljs-params\">()</span></span>;\n}\n</code></pre>\n<h2>四、注意事项</h2>\n<p>1、Update SQL 在更新多张表时，请明确指定字段所属表名</p>\n<blockquote>\n<p>@see com.codingapi.tx.client.spi.transaction.txc.resource.TxcSqlExecuteInterceptor.preUpdate<br>\n@see com.codingapi.tx.client.spi.transaction.txc.resource.TxcSqlExecuteInterceptor.preSelect</p>\n</blockquote>\n",
  "link": "/zh-cn/docs/principle/txc.html",
  "meta": {}
}